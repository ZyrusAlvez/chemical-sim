<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChemSim</title>
    <script src="https://cdn.jsdelivr.net/npm/ola@2.0.1/dist/ola.min.js"></script>
    <style>
        @font-face {
            font-family: "BreakingBad";
            src: url("https://cdn.jsdelivr.net/gh/olivier3lanc/cinematics-resources/breaking_bad_intro/heartBB.woff2") format("woff2");
            font-style: normal;
            font-display: swap;
            font-weight: 400
        }

        @font-face {
            font-family: "SFPro-Regular";
            src: url("https://cdn.jsdelivr.net/gh/olivier3lanc/cinematics-resources/breaking_bad_intro/SFProDisplay-Regular.woff2") format("woff2");
            font-style: normal;
            font-display: swap;
            font-weight: 400
        }

        @font-face {
            font-family: "SFPro-Bold";
            src: url("https://cdn.jsdelivr.net/gh/olivier3lanc/cinematics-resources/breaking_bad_intro/SFProDisplay-Bold.woff2") format("woff2");
            font-style: normal;
            font-display: swap;
            font-weight: 700
        }

        @font-face {
            font-family: "AtticAntique";
            src: url("https://cdn.jsdelivr.net/gh/olivier3lanc/cinematics-resources/breaking_bad_intro/AtticAntique.woff2") format("woff2");
            font-style: normal;
            font-display: swap;
            font-weight: 400
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            overscroll-behavior: none;
            margin: 0;
            min-height: 100vh;
            background-color: #011905;
            color: white;
            font-family: SFPro-Regular;
        }

        [scroll-btween] {
            transition: none !important;
        }

        .d-flex {
            display: flex;
        }

        .fd-column {
            flex-direction: column;
        }

        .ai-center {
            align-items: center;
        }

        .jc-center {
            justify-content: center;
        }

        .jc-space-between {
            justify-content: space-between;
        }

        .pos-fixed {
            position: fixed;
        }

        .pos-absolute {
            position: absolute;
        }

        .pos-relative {
            position: relative;
        }

        .top-0 {
            top: 0;
        }

        .top-50 {
            top: 50%;
        }

        .left-0 {
            left: 0;
        }

        .left-50 {
            left: 50%;
        }

        .bottom-0 {
            bottom: 0;
        }

        .w-100 {
            width: 100%;
        }

        .h-100 {
            height: 100%;
        }

        .p-0 {
            padding: 0;
        }

        .p-1 {
            padding: 4px;
        }

        .p-5 {
            padding: 24px;
        }

        .p-8 {
            padding: 64px;
        }

        .pl-2 {
            padding-left: 8px;
        }

        .m-0 {
            margin: 0;
        }

        .ml-1 {
            margin-left: 4px;
        }

        .ml-special-1 {
            margin-left: calc(2 * 64px + 2px);
        }

        .mt-2px {
            margin-top: 2px;
        }

        .mt-offset-1 {
            margin-top: -0.06em;
        }

        .mt-offset-2 {
            margin-top: 0.06em;
        }

        .z-3 {
            z-index: 3;
        }

        .t-tX-50 {
            transform: translateX(-50%);
        }

        .t-tY-50 {
            transform: translateY(-50%);
        }

        .ar-1 {
            aspect-ratio: 1;
        }

        .ls-none {
            list-style: none;
        }

        .ff-400 {
            font-family: SFPro-Regular;
        }

        .ff-700 {
            font-family: SFPro-Bold;
        }

        .ff-heart {
            font-family: BreakingBad, sans-serif;
        }



        .ff-formulae {
            font-family: AtticAntique, sans-serif;
        }

        .fs-1 {
            font-size: 10px;
        }

        .fs-2 {
            font-size: 12px;
        }

        .fs-4 {
            font-size: 16px;
        }

        .fs-5 {
            font-size: 24px;
        }

        .fs-6 {
            font-size: 36px;
        }

        .fs-7 {
            font-size: 58px;
        }

        .fs-8 {
            font-size: 84px;
        }

        .fs-9 {
            font-size: 98px;
        }

        .fs-10 {
            font-size: 130px;
        }

        .lh-0 {
            line-height: 0em;
        }

        .lh-special-1 {
            line-height: 0.8em;
        }

        .ta-center {
            text-align: center;
        }

        .c-0 {
            color: transparent;
        }

        .c-neutral-100 {
            color: white;
        }

        .c-secondary-100 {
            color: #4ea281;
        }

        .bc-0 {
            background-color: transparent;
        }

        .b-0 {
            border: none;
        }

        .cur-pointer {
            cursor: pointer;
        }

        .opa-0 {
            opacity: 0;
        }

        .opa-7 {
            opacity: 0.7;
        }

        .outl-1 {
            outline: 2px solid currentColor;
        }

        .maxw-2ch {
            max-width: 2ch;
        }

        .ta-right {
            text-align: right;
        }

        .d-none {
            display: none;
        }

        .bsize-cover {
            background-size: cover;
        }

        .bpos-center {
            background-position: center;
        }

        .mbm-multiply {
            mix-blend-mode: multiply;
        }

        .mbm-overlay {
            mix-blend-mode: overlay;
        }

        .bg-1 {
            background: linear-gradient(135deg, #4ea281, #1f401d);
        }

        .bg-2 {
            background: radial-gradient(ellipse at center, hsl(114deg 35% 22%) 0%, hsl(117deg 37% 21%) 8%, hsl(121deg 40% 20%) 14%, hsl(124deg 46% 19%) 20%, hsl(128deg 54% 17%) 26%, hsl(132deg 65% 16%) 33%, hsl(137deg 83% 14%) 39%, hsl(137deg 80% 13%) 47%, hsl(137deg 77% 11%) 55%, hsl(137deg 73% 10%) 64%, hsl(134deg 68% 9%) 74%, hsl(131deg 69% 7%) 86%, hsl(130deg 92% 5%) 100%);
        }

        .bg-4 {
            background: center / cover no-repeat url('https://cdn.jsdelivr.net/gh/olivier3lanc/cinematics-resources/breaking_bad_intro/cloud.avif');
        }

        .__rust {
            -webkit-background-clip: text;
            background-image: url('https://cdn.jsdelivr.net/gh/olivier3lanc/cinematics-resources/breaking_bad_intro/rust.webp');
        }

        @keyframes formulae1 {
            0% {
                transform: translateX(-50%) translateY(-50%) translateZ(800px);
                opacity: 0.6;
            }

            100% {
                transform: translateX(-50%) translateY(-50%) translateZ(-800px);
                opacity: 0;
            }
        }

        @keyframes formulae2 {
            0% {
                transform: translateX(-50%) translateY(-50%) translateZ(800px);
                opacity: 0.4;
            }

            100% {
                transform: translateX(-50%) translateY(-50%) translateZ(-800px);
                opacity: 0;
            }
        }

        @keyframes smoke {
            0% {
                transform: perspective(800px) translateZ(0px);
                opacity: 0;
            }

            50% {
                transform: perspective(800px) translateZ(400px);
                opacity: 1;
            }

            100% {
                transform: perspective(800px) translateZ(800px);
                opacity: 0;
            }
        }

        .__stop_animations>* {
            animation-play-state: paused !important;
        }

        @media (min-width: 0px) and (max-width: 599px) {
            [p-7*="xs"] {
                padding: 48px;
            }

            [fs-7*="xs"] {
                font-size: 58px;
            }

            [fs-8*="xs"] {
                font-size: 84px;
            }

            [fs-9*="xs"] {
                font-size: 98px;
            }

            [ml-special-2*="xs"] {
                margin-left: calc(2 * 48px + 2px);
            }

            [d-none*="xs"] {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- Background radial gradient -->
    <div class="pos-fixed bottom-0 left-0 | w-100 h-100 | bg-2"></div>
    <!-- Smoke / smug effect -->
    <div class="pos-fixed bottom-0 left-0 | w-100 h-100 | opa-7 bg-4 mbm-multiply"></div>
    <div class="pos-fixed bottom-0 left-0 | w-100 h-100 | opa-0 bg-4 mbm-overlay"
        style="animation: smoke 5s linear 0s infinite forwards;"></div>
    <div class="pos-fixed bottom-0 left-0 | w-100 h-100 | opa-0 bg-4 mbm-overlay"
        style="animation: smoke 5s linear 2.5s infinite forwards;"></div>

    <!-- Main title + Play wrapped in a single Flexbox column to prevent zoom overlap -->
    <div id="chemsim-intro-stack" class="pos-fixed top-0 left-0 w-100 h-100 z-3"
        style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4vh; pointer-events: none;">

        <!-- Main title -->
        <header style="pointer-events: none; flex-shrink: 0;">
            <h1 class="d-flex fd-column | m-0 | ff-400" scroll-btween="header" data-detector="final_text_detector"
                data-transform="perspective(800px) translateZ(|0 to -400|px)">
                <!-- (C)hem -->
                <span class="d-flex ai-center | pos-relative">
                    <!-- Periodic table 1 container -->
                    <span class="d-flex | pos-relative | ar-1" style="padding: 100px;" scroll-btween="table1"
                        data-detector="table1_detector" data-transform="perspective(1400px) translateZ(|500 to -500|px)"
                        data-opacity="|0:0 to 50:0.5 to 60:0.3 to 100:0|">
                    </span>
                    <!-- Permanent C element -->
                    <span class="d-flex | pos-absolute top-0 left-0 z-1 | ar-1 | bg-1"
                        style="padding: 100px; outline: 3px solid currentColor;" scroll-btween="carbon"
                        data-detector="table1_detector" data-opacity="|0:0 to 40:0 to 50:0.8 to 100:1|">
                        <span class="d-flex jc-space-between | pos-absolute top-0 left-0 | w-100 p-1">
                            <code class="ff-400 fs-1">12.011</code>
                            <code class="maxw-2ch | ff-400 fs-1 ta-right">+4 -4</code>
                        </span>
                        <span class="d-flex fd-column | pos-absolute bottom-0 left-0 | p-1 | fs-2">
                            <span class="d-flex fd-column">
                                <code class="ff-700">6</code>
                                <code class="ff-400 fs-1">2-4</code>
                            </span>
                        </span>
                        <span class="pos-absolute top-50 left-50 t-tY-50 t-tX-50 | mt-offset-1 | ff-700 ta-center"
                            style="transform: translate(-50%, -50%); font-size: 120px;">C</span>
                    </span>
                    <!-- hem text first line -->
                    <span class="pl-2 mt-offset-2 ff-700 lh-special-1" scroll-btween="hem"
                        data-detector="final_text_detector" data-opacity="|0:0 to 20:1 to 100:1|"
                        style="font-size: 160px; color: #4ea281; letter-spacing: -2px;">
                        hem
                    </span>
                </span>

                <!-- (Si)m -->
                <span class="d-flex ai-center | pos-relative | ml-special-1 mt-2px" ml-special-2="xs">
                    <!-- Periodic table 2 container -->
                    <span class="d-flex | pos-relative | ar-1" style="padding: 100px;" scroll-btween="table2"
                        data-detector="table2_detector" data-transform="perspective(1400px) translateZ(|500 to -500|px)"
                        data-opacity="|0:0 to 50:0.5 to 100:0|">
                    </span>
                    <!-- Permanent Si element -->
                    <span class="d-flex | pos-absolute top-0 left-0 | ar-1 | bg-1"
                        style="padding: 100px; outline: 3px solid currentColor;" scroll-btween="silicon"
                        data-detector="table2_detector" data-opacity="|0:0 to 40:0 to 50:0.8 to 100:1|">
                        <span class="d-flex jc-space-between | pos-absolute top-0 left-0 | w-100 p-1">
                            <code class="ff-400 fs-1">28.085</code>
                            <code class="maxw-2ch | ff-400 fs-1 ta-right">+4 -4</code>
                        </span>
                        <span class="d-flex fd-column | pos-absolute bottom-0 left-0 | p-1 | fs-2">
                            <span class="d-flex fd-column">
                                <code class="ff-700">14</code>
                                <code class="ff-400 fs-1">2-8-4</code>
                            </span>
                        </span>
                        <span class="pos-absolute top-50 left-50 t-tY-50 t-tX-50 | mt-offset-1 | ff-700 ta-center"
                            style="transform: translate(-50%, -50%); font-size: 120px;">Si</span>
                    </span>
                    <!-- m text second line -->
                    <span class="pl-2 mt-offset-2 ff-700 lh-special-1" scroll-btween="m"
                        data-detector="final_text_detector" data-opacity="|0:0 to 20:1 to 100:1|"
                        style="font-size: 160px; color: #4ea281; letter-spacing: -2px;">
                        m
                    </span>
                </span>
            </h1>
        </header>

        <!-- Formulaes -->
        <ul class="pos-fixed bottom-0 left-0 | w-100 h-100 p-0 m-0 | ls-none" style="perspective: 800px;"
            scroll-btween="formulaes" data-detector="table1_detector" data-opacity="|0:1 to 30:0 to 100:0|" d-none="xs">
            <li class="pos-fixed | fs-8 ff-formulae | opa-0"
                style="top: 40%; left: 50%; animation: formulae1 15s linear 0s infinite forwards;">C<sub>5</sub>
                H<sub>10</sub> N</li>
            <li class="pos-fixed | fs-6 ff-formulae | opa-0"
                style="top: 20%; left: 80%; animation: formulae2 10s linear 1s infinite forwards;">C<sub>5</sub>
                H<sub>10</sub> N</li>
            <li class="pos-fixed | fs-5 ff-formulae | opa-0"
                style="top: 45%; left: 45%; animation: formulae2 12s linear 2s infinite forwards;">C<sub>5</sub>
                H<sub>10</sub> N</li>
            <li class="pos-fixed | fs-8 ff-formulae | opa-0"
                style="top: 60%; left: 15%; animation: formulae1 9s linear 0s infinite forwards;">C<sub>5</sub></li>
            <li class="pos-fixed | fs-7 ff-formulae | opa-0"
                style="top: 80%; left: 35%; animation: formulae1 12s linear 2s infinite forwards;">C<sub>5</sub></li>
            <li class="pos-fixed | fs-10 ff-formulae | opa-0"
                style="top: 20%; left: 20%; animation: formulae1 15s linear 3s infinite forwards;">H<sub>10</sub></li>
            <li class="pos-fixed | fs-10 ff-formulae | opa-0"
                style="top: 60%; left: 80%; animation: formulae2 10s linear 1s infinite forwards;">H<sub>10</sub></li>
            <li class="pos-fixed | fs-9 ff-formulae | opa-0"
                style="top: 10%; left: 55%; animation: formulae1 7s linear 1s infinite forwards;">N</li>
            <li class="pos-fixed | fs-8 ff-formulae | opa-0"
                style="top: 60%; left: 25%; animation: formulae2 10s linear 3s infinite forwards;">N</li>
            <li class="pos-fixed | fs-7 ff-formulae | opa-0"
                style="top: 30%; left: 60%; animation: formulae2 8s linear 2s infinite forwards;">149.24</li>
            <li class="pos-fixed | fs-6 ff-formulae | opa-0"
                style="top: 60%; left: 20%; animation: formulae1 5s linear 4s infinite forwards;">149.24</li>
            <li class="pos-fixed | fs-5 ff-formulae | opa-0"
                style="top: 20%; left: 20%; animation: formulae1 5s linear 4s infinite forwards;">meth</li>
            <li class="pos-fixed | fs-4 ff-formulae | opa-0"
                style="top: 60%; left: 50%; animation: formulae2 7s linear 2s infinite forwards;">meth</li>
        </ul>

        <!-- Start help -->
        <p class="d-flex fd-column ai-center jc-center | pos-fixed top-0 left-0 | w-100 h-100 m-0"
            scroll-btween="scroll_text" data-detector="table1_detector" data-opacity="|0:1 to 30:0 to 100:0|"
            data-transform="perspective(800px) translateZ(-|0:0 to 30:700 to 100:700|px)"
            style="color: #4ea281; font-size: 24px; font-family: SFPro-Bold;">
            Scroll Down
        </p>

        <!-- Play Button & Tutorial (inside the same flex column) -->
        <div scroll-btween="play_button" data-detector="final_text_detector"
            data-opacity="|0:0 to 50:0 to 85:1 to 100:1|"
            style="display: flex; flex-direction: column; align-items: center; gap: 16px; pointer-events: none; flex-shrink: 0;">

            <!-- Play Button -->
            <a href="game.html" id="play-btn"
                style="text-decoration: none; pointer-events: auto; display: inline-block; padding: clamp(10px, 2vw, 16px) clamp(36px, 7vw, 70px); background: linear-gradient(135deg, #4ea281, #2ecc71); color: #ffffff; font-family: SFPro-Bold, sans-serif; font-size: clamp(1.2rem, 2.5vw, 2rem); letter-spacing: 6px; text-transform: uppercase; border-radius: 12px; border: 3px solid #4ea281; box-shadow: 0 0 30px rgba(78, 162, 129, 0.6), 0 8px 25px rgba(0,0,0,0.4); transition: transform 0.25s, box-shadow 0.25s, filter 0.25s;"
                onmouseover="this.style.transform='scale(1.08)'; this.style.boxShadow='0 0 50px rgba(78, 162, 129, 0.9), 0 12px 35px rgba(0,0,0,0.5)'; this.style.filter='brightness(1.15)'"
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 30px rgba(78, 162, 129, 0.6), 0 8px 25px rgba(0,0,0,0.4)'; this.style.filter='brightness(1)'"
                onclick="event.preventDefault(); document.body.style.transition='opacity 0.5s ease'; document.body.style.opacity='0'; setTimeout(function(){ window.location.href='game.html'; }, 500);">
                PLAY
            </a>

            <p class="m-0"
                style="color: #4ea281; font-size: clamp(12px, 1.5vw, 15px); font-family: SFPro-Regular, sans-serif; opacity: 0.7;">
                Click to Start
            </p>

            <!-- Tutorial Button -->
            <a href="game.html?scene=tutorial"
                style="text-decoration: none; pointer-events: auto; padding: clamp(6px, 1vw, 9px) clamp(18px, 3.5vw, 28px); border: 1px solid #4ea281; border-radius: 6px; color: #4ea281; font-family: SFPro-Bold, sans-serif; font-size: clamp(11px, 1.2vw, 13px); letter-spacing: 2px; transition: all 0.3s; text-transform: uppercase; background: rgba(0,0,0,0.4);"
                onmouseover="this.style.background='#4ea281'; this.style.color='#000000'; this.style.boxShadow='0 0 10px rgba(78, 162, 129, 0.4)'"
                onmouseout="this.style.background='rgba(0,0,0,0.4)'; this.style.color='#4ea281'; this.style.boxShadow='none'">
                Tutorial
            </a>
        </div>
    </div>


    <div style="padding-top: 100vh; padding-bottom: 30vh">
        <div id="table1_detector"></div>
    </div>
    <div style="padding-top: 30vh; padding-bottom: 80vh">
        <div id="table2_detector"></div>
    </div>
    <div style="padding-bottom: 100vh">
        <div id="final_text_detector"></div>
    </div>

    <!-- Home Page Exit Button - Simple Text Style -->
    <a href="#" id="exit-btn-home"
        style="text-decoration: none; position: fixed; bottom: 40px; right: 40px; pointer-events: auto; padding: 8px 24px; border: 1px solid #4ea281; border-radius: 4px; color: #4ea281; font-family: SFPro-Bold, Verdana; font-size: 14px; letter-spacing: 1px; transition: all 0.3s; text-transform: uppercase; background: rgba(0,0,0,0.4); z-index: 1000;"
        onmouseover="this.style.background='#4ea281'; this.style.color='#000000'; this.style.boxShadow='0 0 10px rgba(78, 162, 129, 0.4)'"
        onmouseout="this.style.background='rgba(0,0,0,0.4)'; this.style.color='#4ea281'; this.style.boxShadow='none'"
        onclick="document.getElementById('thank-you-overlay').style.display = 'flex'; return false;">
        âœ• Exit
    </a>

    <!-- Thank You Overlay -->
    <div id="thank-you-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(1, 25, 5, 0.95); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.5s ease;">
        <h1
            style="font-family: 'Verdana', sans-serif; font-size: 50px; color: #4ea281; margin-bottom: 20px; text-shadow: 0 0 20px rgba(78, 162, 129, 0.6); text-align: center;">
            ChemSim</h1>
        <h2
            style="font-family: 'Verdana', sans-serif; font-size: 30px; color: #ecf0f1; margin-bottom: 10px; font-weight: normal;">
            Thank You for Playing</h2>
        <p style="font-family: 'Verdana', sans-serif; font-size: 16px; color: #95a5a6; margin-bottom: 40px;">You can now
            close this tab.</p>

        <button onclick="location.href='index.html'"
            style="padding: 12px 30px; background: transparent; border: 2px solid #4ea281; color: #4ea281; font-family: 'Verdana', sans-serif; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 4px; transition: all 0.3s;"
            onmouseover="this.style.backgroundColor='#4ea281'; this.style.color='#000000'; this.style.boxShadow='0 0 15px rgba(78, 162, 129, 0.5)'"
            onmouseout="this.style.backgroundColor='transparent'; this.style.color='#4ea281'; this.style.boxShadow='none'">
            Play Again
        </button>
    </div>

    <script>
        // Check for 'showThanks' query param
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('showThanks') === 'true') {
            const overlay = document.getElementById('thank-you-overlay');
            overlay.style.display = 'flex';
            // Small timeout to allow display:flex to apply before changing opacity for transition
            setTimeout(() => { overlay.style.opacity = '1'; }, 10);

            // Clean URL
            window.history.replaceState({}, document.title, window.location.pathname);
        } else {
            // Logic for button click animation if needed
            const exitBtn = document.getElementById('exit-btn-home');
            if (exitBtn) {
                exitBtn.addEventListener('click', function () {
                    const overlay = document.getElementById('thank-you-overlay');
                    overlay.style.display = 'flex';
                    setTimeout(() => { overlay.style.opacity = '1'; }, 10);
                });
            }
        }

        // Scroll Btween implementation (simplified)
        const scrollBtween = {
            defaults: { tweenerIntervalinMs: 300, enabled: true },
            tween: {},
            tweenIndex: {},

            getIntersection: function (el) {
                let response = -1;
                if (typeof el == 'object') {
                    const detector_id = el.dataset.detector;
                    if (detector_id !== undefined) {
                        const el_detector = document.getElementById(detector_id);
                        if (el_detector !== null) el = el_detector;
                    }
                    if (typeof el.getBoundingClientRect == 'function') {
                        const box = el.getBoundingClientRect();
                        const el_offset_top = box.top + window.pageYOffset - document.documentElement.clientTop;
                        const el_height = el.clientHeight;
                        const window_scroll_top = (document.documentElement && document.documentElement.scrollTop) || document.body.scrollTop;
                        const window_height = window.document.documentElement.clientHeight;
                        response = (window_scroll_top + window_height - el_offset_top) / (window_height + el_height);
                    }
                }
                return response;
            },

            update: function () {
                let elems_anims = document.querySelectorAll('[scroll-btween]');
                if (elems_anims !== null) {
                    let ola_object = {};
                    elems_anims.forEach(function (anim) {
                        const anim_id = anim.getAttribute('scroll-btween');
                        scrollBtween['tweenIndex'][anim_id] = { transfer: {}, properties: [] };

                        Object.keys(anim.dataset).forEach(function (property) {
                            const sourceExpression = anim.dataset[property].split('|');
                            let finalExpression = [];
                            let index = 0;

                            sourceExpression.forEach(function (partial) {
                                const fromToArray = partial.split(' to ');
                                if (fromToArray.length > 1) {
                                    const fromValue = parseFloat(fromToArray[0]);
                                    const toValue = parseFloat(fromToArray[1]);
                                    const tween_id = anim_id + '_' + property + '_' + index.toString();

                                    if (typeof Ola == 'function') {
                                        ola_object[tween_id] = fromValue;
                                    }

                                    finalExpression.push(tween_id);
                                    scrollBtween.tweenIndex[anim_id]['transfer'][tween_id] = function (scroll_line) {
                                        let response = 0
                                        if (typeof scroll_line == 'number') {
                                            if (scroll_line > 1) scroll_line = 1;
                                            if (scroll_line < 0) scroll_line = 0;

                                            if (partial.indexOf(':') > 0) {
                                                let xa = 0, ya = fromValue, xb = 1, yb = 1;
                                                fromToArray.forEach(function (keypoint, keyPointIndex) {
                                                    if (keyPointIndex < fromToArray.length - 1) {
                                                        const positionCurrent = parseFloat(keypoint.split(':')[0]) / 100;
                                                        const positionNext = parseFloat(fromToArray[keyPointIndex + 1].split(':')[0]) / 100;

                                                        if (scroll_line >= positionCurrent && scroll_line <= positionNext) {
                                                            xa = positionCurrent;
                                                            ya = parseFloat(keypoint.split(':')[1]);
                                                            xb = positionNext;
                                                            yb = parseFloat(fromToArray[keyPointIndex + 1].split(':')[1]);
                                                        }
                                                    }
                                                });
                                                const coef = (yb - ya) / (xb - xa);
                                                const y0 = yb - coef * xb;
                                                response = coef * scroll_line + y0;
                                            } else {
                                                response = (toValue - fromValue) * scroll_line + fromValue;
                                            }
                                        }
                                        return response;
                                    }
                                    index++;
                                } else {
                                    finalExpression.push(partial);
                                }
                            });
                            scrollBtween.tweenIndex[anim_id]['properties'].push({
                                property: property,
                                expression: finalExpression
                            });
                        });
                    });

                    if (typeof Ola == 'function') {
                        scrollBtween['tween'] = Ola(ola_object);
                        window.addEventListener('scroll', scrollBtween.updateTweenerValues, { passive: true });
                        window.addEventListener('load', scrollBtween.updateTweenerValues);
                    }
                    requestAnimationFrame(scrollBtween.apply);
                }
            },

            updateTweenerValues: function (delay = scrollBtween.defaults.tweenerIntervalinMs) {
                if (typeof Ola == 'function') {
                    for (const anim_id in scrollBtween.tweenIndex) {
                        const node = document.querySelector('[scroll-btween="' + anim_id + '"]');
                        if (node !== null) {
                            const scroll_line = scrollBtween.getIntersection(node);
                            let ola_update_set = {};
                            for (const tween_id in scrollBtween['tweenIndex'][anim_id]['transfer']) {
                                ola_update_set[tween_id] = scrollBtween['tweenIndex'][anim_id]['transfer'][tween_id](scroll_line);
                            }
                            scrollBtween.tween.set(ola_update_set, delay);
                        }
                    }
                }
            },

            apply: function () {
                for (const anim_id in scrollBtween.tweenIndex) {
                    const node = document.querySelector('[scroll-btween="' + anim_id + '"]');
                    if (node !== null) {
                        let scroll_line = 0;
                        if (typeof Ola == 'undefined') {
                            scroll_line = scrollBtween.getIntersection(node);
                        }
                        if (typeof scrollBtween['tweenIndex'][anim_id]['properties'] == 'object') {
                            scrollBtween['tweenIndex'][anim_id]['properties'].forEach(function (data) {
                                let completeTweenedValueToApply = '';
                                data.expression.forEach(function (partialValue) {
                                    if (typeof scrollBtween['tweenIndex'][anim_id]['transfer'][partialValue] == 'function') {
                                        if (typeof Ola == 'function') {
                                            completeTweenedValueToApply += scrollBtween.tween[partialValue].toString();
                                        } else {
                                            completeTweenedValueToApply += scrollBtween['tweenIndex'][anim_id]['transfer'][partialValue](scroll_line).toString();
                                        }
                                    } else {
                                        completeTweenedValueToApply += partialValue;
                                    }
                                });
                                node.style[data.property] = completeTweenedValueToApply;
                            });
                        }
                    }
                }
                if (scrollBtween.defaults.enabled) {
                    requestAnimationFrame(scrollBtween.apply);
                }
            }
        };

        scrollBtween.update();

        // ChemSim Intro - Periodic Table Elements
        const chemsim = {
            elTable1: document.querySelector('[scroll-btween="table1"]'),
            elTable2: document.querySelector('[scroll-btween="table2"]'),
            elFormulaes: document.querySelector('[scroll-btween="formulaes"]'),
            data: [
                // C (Carbon) - group 14
                {
                    target: 'elTable1',
                    atomic_mass: 28.085,
                    number: 14,
                    symbol: 'Si',
                    shells: [2, 8, 4],
                    oxidation_states: ['+4', '-4'],
                    top: 'calc(100% + 2px)',
                    left: '0%'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 72.6308,
                    number: 32,
                    symbol: 'Ge',
                    shells: [2, 8, 18, 4],
                    oxidation_states: ['+4', '-4'],
                    top: 'calc(200% + 4px)',
                    left: '0%'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 10.81,
                    number: 5,
                    symbol: 'B',
                    shells: [2, 3],
                    oxidation_states: ['+3'],
                    top: '0%',
                    left: 'calc(-100% - 2px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 26.98153857,
                    number: 13,
                    symbol: 'Al',
                    shells: [2, 8, 3],
                    oxidation_states: ['+3'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(-100% - 2px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 14.007,
                    number: 7,
                    symbol: 'N',
                    shells: [2, 5],
                    oxidation_states: ['+5', '+3', '-3'],
                    top: '0%',
                    left: 'calc(100% + 2px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 30.9737619985,
                    number: 15,
                    symbol: 'P',
                    shells: [2, 8, 5],
                    oxidation_states: ['+5', '+3', '-3'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(100% + 2px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 15.999,
                    number: 8,
                    symbol: 'O',
                    shells: [2, 6],
                    oxidation_states: ['-2'],
                    top: '0%',
                    left: 'calc(200% + 4px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 32.06,
                    number: 16,
                    symbol: 'S',
                    shells: [2, 8, 6],
                    oxidation_states: ['+6', '+4', '+2', '-2'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(200% + 4px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 18.9984031636,
                    number: 9,
                    symbol: 'F',
                    shells: [2, 7],
                    oxidation_states: ['-1'],
                    top: '0%',
                    left: 'calc(300% + 6px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 35.45,
                    number: 17,
                    symbol: 'Cl',
                    shells: [2, 8, 7],
                    oxidation_states: ['+5', '+3', '+1', '-1'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(300% + 6px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 20.17976,
                    number: 10,
                    symbol: 'Ne',
                    shells: [2, 8],
                    oxidation_states: [],
                    top: '0%',
                    left: 'calc(400% + 8px)'
                },
                {
                    target: 'elTable1',
                    atomic_mass: 39.9481,
                    number: 18,
                    symbol: 'Ar',
                    shells: [2, 8, 8],
                    oxidation_states: [],
                    top: 'calc(100% + 2px)',
                    left: 'calc(400% + 8px)'
                },
                // Si (Silicon) surrounding elements - groups 1-7
                {
                    target: 'elTable2',
                    atomic_mass: 24.305,
                    number: 12,
                    symbol: 'Mg',
                    shells: [2, 8, 2],
                    oxidation_states: ['+2'],
                    top: '0%',
                    left: 'calc(-100% - 2px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 40.0784,
                    number: 20,
                    symbol: 'Ca',
                    shells: [2, 8, 8, 2],
                    oxidation_states: ['+2'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(-100% - 2px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 22.989769282,
                    number: 11,
                    symbol: 'Na',
                    shells: [2, 8, 1],
                    oxidation_states: ['+1'],
                    top: '0%',
                    left: 'calc(-200% - 4px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 39.09831,
                    number: 19,
                    symbol: 'K',
                    shells: [2, 8, 8, 1],
                    oxidation_states: ['+1'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(-200% - 4px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 44.9559085,
                    number: 21,
                    symbol: 'Sc',
                    shells: [2, 8, 9, 2],
                    oxidation_states: ['+3'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(100% + 2px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 47.8671,
                    number: 22,
                    symbol: 'Ti',
                    shells: [2, 8, 10, 2],
                    oxidation_states: ['+4'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(200% + 4px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 50.94151,
                    number: 23,
                    symbol: 'V',
                    shells: [2, 8, 11, 2],
                    oxidation_states: ['+5'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(300% + 6px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 51.99616,
                    number: 24,
                    symbol: 'Cr',
                    shells: [2, 8, 13, 1],
                    oxidation_states: ['+6', '+3'],
                    top: 'calc(100% + 2px)',
                    left: 'calc(400% + 8px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 30.9737619985,
                    number: 15,
                    symbol: 'P',
                    shells: [2, 8, 5],
                    oxidation_states: ['+5', '+3', '-3'],
                    top: '0%',
                    left: 'calc(100% + 2px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 32.06,
                    number: 16,
                    symbol: 'S',
                    shells: [2, 8, 6],
                    oxidation_states: ['+6', '+4', '+2', '-2'],
                    top: '0%',
                    left: 'calc(200% + 4px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 35.45,
                    number: 17,
                    symbol: 'Cl',
                    shells: [2, 8, 7],
                    oxidation_states: ['+5', '+3', '+1', '-1'],
                    top: '0%',
                    left: 'calc(300% + 6px)'
                },
                {
                    target: 'elTable2',
                    atomic_mass: 39.9481,
                    number: 18,
                    symbol: 'Ar',
                    shells: [2, 8, 8],
                    oxidation_states: [],
                    top: '0%',
                    left: 'calc(400% + 8px)'
                }
            ],
            templates: {
                singleElement: function ({ atomic_mass, symbol, number, shells, oxidation_states, top, left }) {
                    return `
                        <span class="d-flex | pos-absolute top-0 left-0 | p-8 ar-1 | outl-1"
                            p-7="xs"
                            style="top: ${top}; left: ${left}">
                            <span class="d-flex jc-space-between | pos-absolute top-0 left-0 | w-100 p-1">
                                <code class="ff-400 fs-1">${atomic_mass}</code>
                                <code class="maxw-2ch | ff-400 fs-1 ta-right">${oxidation_states}</code>
                            </span>
                            <span class="d-flex fd-column | pos-absolute bottom-0 left-0 | p-1 | fs-2">
                                <span class="d-flex fd-column">
                                    <code class="ff-700">${number}</code>
                                    <code class="ff-400 fs-1">${shells}</code>
                                </span>
                            </span>
                            <span class="pos-absolute top-50 left-50 t-tY-50 t-tX-50 | mt-offset-1 | ff-700 fs-8 ta-center" fs-7="xs" style="transform: translate(-50%, -50%);">${symbol}</span>
                        </span>
                    `;
                }
            },
            getCurrentScrollTrackPosition: function () {
                return 100 * window.scrollY / (document.body.clientHeight - window.innerHeight);
            },
            handlers: {
                formulaes: function () {
                    if (chemsim.getCurrentScrollTrackPosition() > 12) {
                        chemsim.elFormulaes.classList.add('__stop_animations');
                    } else {
                        chemsim.elFormulaes.classList.remove('__stop_animations');
                    }
                }
            },
            run: function () {
                chemsim.data.forEach(element => {
                    chemsim[element.target].innerHTML += chemsim.templates.singleElement({
                        atomic_mass: element.atomic_mass,
                        symbol: element.symbol,
                        number: element.number,
                        shells: element.shells.toString().replaceAll(',', '-'),
                        oxidation_states: element.oxidation_states.toString().replaceAll(',', ' '),
                        top: element.top,
                        left: element.left
                    })
                });
                window.addEventListener('scroll', chemsim.handlers.formulaes);
            }
        };

        chemsim.run();
    </script>
</body>

</html>